{"files":[{"id":"e6a00503-62e0-480f-8d91-f2c433500c30","name":"labnol","type":"server_js","source":"\n// The name of the Gmail Label that is to be purged?\nvar GMAIL_LABEL \u003d \"Inbox\";    \n\n\n// Purge messages automatically after how many days?\nvar PURGE_AFTER \u003d \"1\";\n\n\n\n/*\n\n  For details, refer http://labnol.org/?p\u003d27605\n\n\n  T U T O R I A L\n  - - - - - - - - \n  \n  Step 1. Update the values of fields GMAIL_LABEL and PURGE_AFTER above.\n  \n  Step 2. Go to Run -\u003e Initialize and authorize the script.\n  \n  Step 3. Go to Run -\u003e Install to install the script.\n  \n  You can now exit this window and any email messages in Gmail folder will automatically \n  get purged after \u0027n\u0027 days. The script will run by itself everyday at 01:00 hours.\n  \n  Also, you may go to Run -\u003e Uninstall to stop the purging script anytime.\n \n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n*/\n\n\n\n\n\n\nfunction Intialize() {\n  return;\n}\n\nfunction Install() {\n\n  ScriptApp.newTrigger(\"purgeGmail\")\n           .timeBased()\n           .at(new Date((new Date()).getTime() + 1000*60*2))\n           .create();\n  \n  ScriptApp.newTrigger(\"purgeGmail\")\n           .timeBased().everyDays(1).create();\n\n}\n\nfunction Uninstall() {\n  \n  var triggers \u003d ScriptApp.getScriptTriggers();\n  for (var i\u003d0; i\u003ctriggers.length; i++) {\n    ScriptApp.deleteTrigger(triggers[i]);\n  }\n  \n}\n\nfunction purgeGmail() {\n  \n  var age \u003d new Date();  \n  age.setDate(age.getDate() - PURGE_AFTER);    \n  \n  var purge  \u003d Utilities.formatDate(age, Session.getScriptTimeZone(), \"yyyy-MM-dd\");\n  var search \u003d \"label:\" + GMAIL_LABEL + \" before:\" + purge;\n  \n  try {\n    \n    var threads \u003d GmailApp.search(search, 0, 100);\n    \n    if (threads.length \u003d\u003d 100) {\n      ScriptApp.newTrigger(\"purgeGmail\")\n               .timeBased()\n               .at(new Date((new Date()).getTime() + 1000*60*10))\n               .create();\n    }\n    \n    for (var i\u003d0; i\u003cthreads.length; i++) {\n      var messages \u003d GmailApp.getMessagesForThread(threads[i]);\n      for (var j\u003d0; j\u003cmessages.length; j++) {\n        var email \u003d messages[j];       \n        if (email.getDate() \u003c age) {\n          email.moveToTrash();\n        }\n      }\n    }\n    \n  } catch (e) {}\n  \n}"}]}